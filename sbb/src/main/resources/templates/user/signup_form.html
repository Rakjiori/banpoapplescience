<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="layout :: layout (~{::body})"
      th:with="content='this :: content'">

<body>
<div th:fragment="content">

    <div class="container" style="max-width:420px;">

        <div class="card" style="padding:28px 26px;">

            <h1 class="page-title" style="margin-bottom:6px; text-align:center;">회원가입</h1>
            <p style="text-align:center; color:#6b7280; font-size:14px; margin-bottom:16px;">
                학원 페이지에서 사용할 계정 유형을 선택하고 정보를 입력해주세요.
            </p>

            <div th:if="${errorMessage}" class="alert alert-danger" style="margin-bottom:14px;">
                <span th:text="${errorMessage}"></span>
            </div>

            <form method="post" th:action="@{/signup}" style="display:flex; flex-direction:column; gap:12px;">
                <div>
                    <label for="username" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                        아이디
                    </label>
                    <input type="text" id="username" name="username" required
                           th:value="${enteredUsername}">
                </div>

                <div>
                    <label for="password" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                        비밀번호
                    </label>
                    <input type="password" id="password" name="password" required>
                </div>

                <div>
                    <label for="accountType" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                        계정 유형
                    </label>
                    <select id="accountType" name="accountType" required>
                        <option value="">선택해주세요</option>
                        <option th:each="type : ${accountTypes}"
                                th:value="${type.name()}"
                                th:selected="${selectedAccountType} == ${type.name()}"
                                th:text="${type.name() == 'STUDENT' ? '학생' : (type.name() == 'ASSISTANT' ? '조교(관리자)' : '학부모')}">
                        </option>
                    </select>
                    <p class="muted" style="font-size:12px; margin-top:4px;">
                        조교는 루트 계정이 관리자 권한을 부여할 수 있습니다.
                    </p>
                </div>

                <div>
                    <label for="fullName" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                        이름
                    </label>
                    <input type="text" id="fullName" name="fullName"
                           placeholder="예: 홍길동"
                           th:value="${enteredFullName}">
                </div>

                <div id="studentFields" style="display:none;">
                    <div style="margin-top:6px;">
                        <label for="schoolName" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                            학교
                        </label>
                        <input type="text" id="schoolName" name="schoolName"
                               placeholder="예: 서울고등학교"
                               th:value="${enteredSchoolName}">
                    </div>
                    <div style="margin-top:10px;">
                        <label for="grade" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                            학년
                        </label>
                        <input type="text" id="grade" name="grade"
                               placeholder="예: 2학년"
                               th:value="${enteredGrade}">
                    </div>
                </div>

                <button type="submit" class="btn" style="width:100%; margin-top:10px;">
                    가입하기
                </button>

            </form>

            <script th:inline="javascript">
                const accountTypeSelect = document.getElementById('accountType');
                const studentFields = document.getElementById('studentFields');
                const fullNameInput = document.getElementById('fullName');
                const schoolInput = document.getElementById('schoolName');
                const gradeInput = document.getElementById('grade');

                const syncVisibility = () => {
                    const type = accountTypeSelect.value;
                    const isStudent = type === 'STUDENT';
                    studentFields.style.display = isStudent ? 'block' : 'none';
                    fullNameInput.required = type !== '';
                    schoolInput.required = isStudent;
                    gradeInput.required = isStudent;
                };

                accountTypeSelect.addEventListener('change', syncVisibility);
                document.addEventListener('DOMContentLoaded', syncVisibility);
            </script>

        </div>

        <p style="text-align:center; font-size:13px; color:#6b7280; margin-top:10px;">
            이미 계정이 있으신가요?
            <a href="/login" style="font-weight:600;">로그인</a>
        </p>

    </div>

</div>
</body>
</html>
