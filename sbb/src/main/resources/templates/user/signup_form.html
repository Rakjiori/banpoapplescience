<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      th:replace="layout :: layout (~{::body})"
      th:with="content='this :: content'">

<body>
<div th:fragment="content">

    <div class="container" style="max-width:420px;">

        <div class="card" style="padding:28px 26px;">

            <h1 class="page-title" style="margin-bottom:6px; text-align:center;">회원가입</h1>
            <p style="text-align:center; color:#6b7280; font-size:14px; margin-bottom:16px;">
                계정 유형을 선택하고 정보를 입력해주세요.
            </p>

            <div th:if="${errorMessage}" class="alert alert-danger" style="margin-bottom:14px;">
                <span th:text="${errorMessage}"></span>
            </div>

            <form method="post" th:action="@{/signup}" style="display:flex; flex-direction:column; gap:12px;">
                <div>
                    <label for="username" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                        아이디
                    </label>
                    <input type="text" id="username" name="username" required
                           th:value="${enteredUsername}">
                </div>

                <div>
                    <label for="password" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                        비밀번호
                    </label>
                    <input type="password" id="password" name="password" required>
                </div>

                <div>
                    <label for="confirmPassword" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                        비밀번호 확인
                    </label>
                    <input type="password" id="confirmPassword" name="confirmPassword" required>
                </div>

                <div>
                    <label for="accountType" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                        계정 유형
                    </label>
                    <select id="accountType" name="accountType" required>
                        <option value="">선택해주세요</option>
                        <option th:each="type : ${accountTypes}"
                                th:value="${type.name()}"
                                th:selected="${selectedAccountType} == ${type.name()}"
                                th:text="${type.name() == 'STUDENT' ? '학생' : (type.name() == 'ASSISTANT' ? '조교(관리자)' : '학부모')}">
                        </option>
                    </select>
                    <p class="muted" style="font-size:12px; margin-top:4px;">
                        
                    </p>
                </div>

                <div>
                    <label id="fullNameLabel" for="fullName" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                        이름
                    </label>
                    <input type="text" id="fullName" name="fullName"
                           placeholder="예: 홍길동"
                           th:value="${enteredFullName}">
                    <p id="nameHelper" class="muted" style="font-size:12px; margin-top:4px; display:none;">
                        
                    </p>
                </div>

                <div id="assistantFields" style="display:none;">
                    <label for="assistantPhone" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                        조교 전화번호
                    </label>
                    <input type="tel" id="assistantPhone" name="assistantPhone"
                           placeholder="예: 010-1234-5678"
                           th:value="${enteredAssistantPhone}">
                    <p class="muted" style="font-size:12px; margin-top:4px;">
                        조교 연락을 위한 번호를 입력해주세요.
                    </p>
                </div>

                <div id="studentFields" style="display:none;">
                    <div style="margin-bottom:6px;">
                        <span style="font-size:13px; color:#374151; font-weight:600;">학생 정보</span>
                        <p class="muted" style="font-size:12px; margin-top:2px;">
                            학생 또는 학부모 선택 시 학생의 학교와 학년을 입력해주세요.
                        </p>
                    </div>
                    <div style="margin-top:6px;">
                        <label for="schoolName" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                            학교
                        </label>
                        <select id="schoolName" name="schoolName">
                            <option value="">학교를 선택하세요</option>
                            <option th:selected="${enteredSchoolName} == '세화고'">세화고</option>
                            <option th:selected="${enteredSchoolName} == '세화여고'">세화여고</option>
                            <option th:selected="${enteredSchoolName} == '반포고'">반포고</option>
                            <option th:selected="${enteredSchoolName} == '서울고'">서울고</option>
                        </select>
                    </div>
                    <div style="margin-top:10px;">
                        <label for="grade" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                            학년
                        </label>
                        <select id="grade" name="grade">
                            <option value="">학년을 선택하세요</option>
                            <option th:selected="${enteredGrade} == '예비 1학년'">예비 1학년</option>
                            <option th:selected="${enteredGrade} == '1학년'">1학년</option>
                            <option th:selected="${enteredGrade} == '2학년'">2학년</option>
                            <option th:selected="${enteredGrade} == '3학년'">3학년</option>
                            <option th:selected="${enteredGrade} == '졸업생'">졸업생</option>
                        </select>
                    </div>
                    <div>
                        <label for="studentPhone" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                            학생 전화번호
                        </label>
                        <input type="tel" id="studentPhone" name="studentPhone"
                               placeholder="예: 010-1234-5678"
                               th:value="${enteredStudentPhone}">
                        <p class="muted" style="font-size:12px; margin-top:4px;">
                            학생 본인의 연락처를 입력해주세요.
                        </p>
                    </div>
                    <div>
                        <label for="parentPhone" style="font-size:14px; font-weight:500; margin-bottom:4px; display:block;">
                            학부모 전화번호
                        </label>
                        <input type="tel" id="parentPhone" name="parentPhone"
                               placeholder="예: 010-0000-0000"
                               th:value="${enteredParentPhone}">
                        <p class="muted" style="font-size:12px; margin-top:4px;">
                            상담 및 안내를 위한 보호자 연락처를 입력해주세요.
                        </p>
                    </div>
                </div>

                <button type="submit" class="btn" style="width:100%; margin-top:10px;">
                    가입하기
                </button>

                <p style="font-size:12px; color:#6b7280; margin:6px 0 0; text-align:center;">
                    가입을 진행하면
                    <a href="/privacy" target="_blank" rel="noopener" style="font-weight:600;">개인정보 처리방침</a>
                    에 동의한 것으로 간주됩니다.
                </p>

            </form>

            <script th:inline="javascript">
                const accountTypeSelect = document.getElementById('accountType');
                const studentFields = document.getElementById('studentFields');
                const assistantFields = document.getElementById('assistantFields');
                const fullNameLabel = document.getElementById('fullNameLabel');
                const fullNameInput = document.getElementById('fullName');
                const nameHelper = document.getElementById('nameHelper');
                const schoolInput = document.getElementById('schoolName');
                const gradeInput = document.getElementById('grade');
                const studentPhoneInput = document.getElementById('studentPhone');
                const parentPhoneInput = document.getElementById('parentPhone');
                const assistantPhoneInput = document.getElementById('assistantPhone');

                const syncVisibility = () => {
                    const type = accountTypeSelect.value;
                    const requiresStudentInfo = type === 'STUDENT' || type === 'PARENT';
                    const isParent = type === 'PARENT';
                    const isAssistant = type === 'ASSISTANT';

                    studentFields.style.display = requiresStudentInfo ? 'block' : 'none';
                    assistantFields.style.display = isAssistant ? 'block' : 'none';
                    fullNameInput.required = type !== '';
                    schoolInput.required = requiresStudentInfo;
                    gradeInput.required = requiresStudentInfo;
                    studentPhoneInput.required = requiresStudentInfo;
                    parentPhoneInput.required = requiresStudentInfo;
                    assistantPhoneInput.required = isAssistant;

                    if (isParent) {
                        fullNameLabel.textContent = '학생 이름';
                        fullNameInput.placeholder = '예: 홍길동 (학생)';
                        nameHelper.style.display = 'block';
                        nameHelper.textContent = '학부모 계정에 연결될 학생 이름을 입력해주세요.';
                    } else if (requiresStudentInfo) {
                        fullNameLabel.textContent = '학생 이름';
                        fullNameInput.placeholder = '예: 홍길동';
                        nameHelper.style.display = 'block';
                        nameHelper.textContent = '학생 이름을 입력해주세요.';
                    } else if (isAssistant) {
                        fullNameLabel.textContent = '조교 이름';
                        fullNameInput.placeholder = '예: 김조교';
                        nameHelper.style.display = 'block';
                        nameHelper.textContent = '조교 실명을 입력해주세요.';
                    } else {
                        fullNameLabel.textContent = '이름';
                        fullNameInput.placeholder = '예: 홍길동';
                        nameHelper.style.display = 'none';
                    }
                };

                accountTypeSelect.addEventListener('change', syncVisibility);
                document.addEventListener('DOMContentLoaded', syncVisibility);
            </script>

        </div>

        <p style="text-align:center; font-size:13px; color:#6b7280; margin-top:10px;">
            이미 계정이 있으신가요?
            <a href="/login" style="font-weight:600;">로그인</a>
        </p>

    </div>

</div>
</body>
</html>
