<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="layout :: layout(~{::body})">
<body>
<div class="page-card">
    <div class="page-header">
        <div>
            <div class="pill">관리자/루트</div>
            <h1 class="page-title" style="color:#0f172a;" th:text="${note.title}">제목</h1>
            <p class="muted">
                <span th:text="${note.author != null ? note.author.username : '-'}">작성자</span>
                · <span th:text="${#temporals.format(note.createdAt, 'yyyy-MM-dd HH:mm')}">날짜</span>
            </p>
        </div>
        <div style="display:flex; gap:8px;">
            <a th:href="@{'/admin/notes/' + ${note.id} + '/edit'}" class="btn btn-outline">수정</a>
            <form th:action="@{'/admin/notes/' + ${note.id} + '/delete'}" method="post" onsubmit="return confirm('삭제할까요?');">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <button type="submit" class="btn btn-outline" style="color:#b91c1c; border-color:#fca5a5;">삭제</button>
            </form>
        </div>
    </div>

    <div class="card" style="padding:18px; margin-bottom:12px;">
        <div th:utext="${#strings.escapeXml(note.content).replaceAll('\\n','<br/>')}">내용</div>
        <div class="muted" style="margin-top:10px;">
            마지막 수정: <span th:text="${#temporals.format(note.updatedAt, 'yyyy-MM-dd HH:mm')}"></span>
        </div>
    </div>

    <div class="card" style="padding:16px;">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:10px; margin-bottom:12px;">
            <div class="title-md" style="margin:0;">댓글</div>
            <a class="btn btn-outline" href="/admin/notes">← 목록으로</a>
        </div>
        <div style="border:1px solid #e2e8f0; border-radius:12px; padding:12px; background:#f8fbff; margin-bottom:10px;">
            <form th:action="@{'/admin/notes/' + ${note.id} + '/comments'}" method="post" style="display:flex; gap:8px; flex-wrap:wrap; align-items:flex-start;">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <textarea name="content" rows="2" placeholder="댓글을 입력하세요" required style="flex:1; min-width:260px; border:1px solid #cbd5e1; border-radius:10px; padding:10px;"></textarea>
                <button type="submit" class="btn" style="height:40px; padding:0 14px;">댓글 등록</button>
            </form>
        </div>
        <div style="border-top:1px solid #e2e8f0; padding-top:10px; display:flex; justify-content:flex-end; margin-bottom:10px;">
            <a class="btn btn-outline" href="/admin/notes" style="padding:6px 10px;">뒤로가기</a>
        </div>
        <div th:if="${#lists.isEmpty(note.comments)}" class="muted" style="margin-bottom:8px;">댓글이 없습니다.</div>
        <div th:each="c : ${note.comments}" style="border:1px solid #e5e7eb; border-radius:10px; padding:10px 12px; margin-bottom:10px; background:#ffffff;">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:6px;">
                <div>
                    <strong th:text="${c.author != null ? c.author.username : '-'}">작성자</strong>
                    <span class="muted" th:text="${#temporals.format(c.createdAt, 'yyyy-MM-dd HH:mm')}">날짜</span>
                </div>
                <form th:action="@{'/admin/notes/' + ${note.id} + '/comments/' + ${c.id} + '/delete'}" method="post"
                      onsubmit="return confirm('댓글을 삭제할까요?');">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <button class="btn btn-outline" style="padding:4px 8px; color:#b91c1c; border-color:#fca5a5;">삭제</button>
                </form>
            </div>
            <div class="muted" th:text="${c.content}">내용</div>
        </div>
    </div>
</div>
</body>
</html>
