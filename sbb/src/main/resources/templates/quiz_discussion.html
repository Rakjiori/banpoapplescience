<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko"
      th:replace="layout :: layout(~{::body})">
<body>
<div>
    <a href="/quiz/list" class="btn btn-outline" style="margin-bottom:10px;">â† My Questions</a>
    <h1 class="page-title">ë¬¸ì œ í† ë¡ </h1>
    <p style="margin-top:-6px; color:#6b7280; white-space:pre-wrap;" th:text="${question.questionText}">ë¬¸ì œ</p>

    <div class="card">
        <h3 style="margin:0 0 8px;">ëŒ“ê¸€</h3>
        <div style="display:flex; flex-direction:column; gap:8px;">
            <div th:each="item : ${comments}"
                 style="padding:10px; border:1px solid #e5e7eb; border-radius:10px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong class="comment-username" th:text="${item.user.username}">user</strong>
                    <span style="color:#9ca3af; font-size:12px;"
                          th:text="${#temporals.format(item.createdAt, 'yyyy.MM.dd HH:mm')}">date</span>
                </div>
                <div style="margin-top:6px; white-space:pre-wrap;" th:text="${item.content}"></div>
            </div>
            <div th:if="${#lists.isEmpty(comments)}" style="color:#6b7280;">ì²« ëŒ“ê¸€ì„ ë‚¨ê²¨ ë³´ì„¸ìš”.</div>
        </div>

        <form th:action="@{/quiz/discussion/{id}(id=${question.id})}"
              method="post"
              style="margin-top:12px; display:flex; gap:8px; align-items:flex-start;">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <textarea name="content" rows="2" required
                      style="flex:1; padding:10px; border:1px solid #d1d5db; border-radius:10px; resize:vertical;"
                      placeholder="ìƒê°ì„ ê³µìœ í•´ ë³´ì„¸ìš”"></textarea>
            <button type="submit" class="btn" style="padding:10px 14px;">ë“±ë¡</button>
        </form>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', ()=>{
        const avatar = localStorage.getItem('profileAvatar') || 'ğŸ§‘';
        const myName = document.querySelector('meta[name="author"]')?.content || '';
        document.querySelectorAll('.comment-username').forEach(el=>{
            const name = el.textContent || '';
            const icon = (myName && myName === name) ? avatar : 'ğŸ’¬';
            el.textContent = `${icon} ${name}`;
        });
    });
</script>
</body>
</html>
