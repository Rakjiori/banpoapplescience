<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="layout :: layout(~{::body})">
<body>
<div>
    <section class="group-hero">
        <div class="group-hero__eyebrow">Study group</div>
        <div class="group-hero__heading">
            <h1 class="page-title">스터디 그룹</h1>
            <p class="group-hero__text">수업별로 그룹 관리하세요.</p>
        </div>
        <div class="group-hero__stats">
            <div class="stat-chip">
                <span>내 그룹</span>
                <strong th:text="${#lists.size(memberships)}">0</strong>개
            </div>
            <div class="stat-chip stat-chip--ghost">
                <span>실시간 초대 코드 초대 가능</span>
            </div>
        </div>
    </section>

    <div th:if="${message}" class="alert alert-success" style="margin-bottom:12px;">
        <span th:text="${message}"></span>
    </div>
    <div th:if="${error}" class="alert alert-danger" style="margin-bottom:12px;">
        <span th:text="${error}"></span>
    </div>

    <div class="group-grid group-grid--actions">
        <div class="group-action-card">
            <div>
                <div class="group-action__title">새 그룹 만들기</div>
                <p class="group-action__desc">관리자/루트만 새 그룹을 만들 수 있습니다.</p>
            </div>
            <div th:if="${canCreateGroup}">
                <form th:action="@{/groups}" method="post" class="group-inline-form">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                    <input type="text" name="name" placeholder="예: 알고리즘 스터디" required class="group-input">
                    <button type="submit" class="btn group-inline-btn">만들기</button>
                </form>
            </div>
            <div th:if="${!canCreateGroup}" class="muted">
                초대 코드로 참여하거나 관리자에게 요청하세요.
            </div>
        </div>

        <div class="group-action-card group-action-card--alt">
            <div>
                <div class="group-action__title">코드로 참여</div>
                <p class="group-action__desc">초대 코드를 입력해 바로 가입하세요.</p>
            </div>
            <form th:action="@{/groups/join}" method="post" class="group-inline-form">
                <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                <input type="text" name="code" placeholder="초대 코드" required class="group-input">
                <button type="submit" class="btn btn-outline group-inline-btn">참여</button>
            </form>
        </div>
    </div>

    <h3 class="section-title">내 그룹</h3>
    <div th:if="${#lists.isEmpty(memberships)}" class="muted">아직 참여한 그룹이 없습니다.</div>

    <div class="group-grid">
        <a th:each="mem : ${memberships}"
           th:href="@{/groups/{id}(id=${mem.group.id})}"
           class="group-card-modern">
            <div class="group-card__top">
                <div class="group-card__name" th:text="${mem.group.name}">그룹</div>
                <span class="group-card__code">
                    코드: <strong th:text="${mem.group.joinCode}">000000</strong>
                </span>
            </div>
            <p class="group-card__desc">클릭해서 그룹 문제 보기</p>
            <div class="group-card__footer">
                <span class="pill pill-muted">ROLE: <span th:text="${mem.role}">MEMBER</span></span>
                <span class="group-card__chevron">→</span>
            </div>
        </a>
    </div>
</div>
</body>
</html>
