<!-- templates/navbar.html -->
<nav class="navbar" th:fragment="nav">
  <div class="navbar-inner">
    <a class="brand" th:href="@{/}">
      <span class="brand-mark">🍏</span>
      <div class="brand-text">
        <div class="brand-name">애플과학</div>
        <div class="brand-sub">Banpo Apple Science</div>
      </div>
    </a>

    <ul class="nav-links">
      <li><a th:href="@{/#schedule}" data-scroll>시간표</a></li>
      <li><a th:href="@{/#notice}" data-scroll>공지사항</a></li>
      <li><a th:href="@{/#reviews}" data-scroll>수강후기</a></li>
      <li><a th:href="@{/#location}" data-scroll>오시는길</a></li>
    </ul>

    <!-- 우측 로그인/상태 -->
    <div class="user-status nav-actions">
      <a class="nav-pill ghost" th:href="@{/quiz/list}">학습 포털</a>
      <div class="notif-wrapper" th:if="${#authorization.expression('isAuthenticated()')}">
        <button type="button" class="icon-button" id="notificationBell">
          <span class="bell-icon" aria-hidden="true">🔔</span>
          <span class="badge" id="notificationBadge" style="display:none;">0</span>
        </button>
        <div class="notification-panel" id="notificationPanel">
          <div class="notification-header">알림</div>
          <div class="notification-list" id="notificationList">
            <div class="notification-empty">새 알림이 없습니다.</div>
          </div>
        </div>
        <button type="button" class="icon-button" id="friendBell" title="친구 추가" style="margin-left:6px;">
          <span aria-hidden="true">➕</span>
          <span class="badge" id="friendBadge" style="display:none;">0</span>
        </button>
        <div class="notification-panel" id="friendPanel">
          <div class="notification-header">친구 추가</div>
          <form id="friendAddForm" style="padding:10px; display:flex; gap:8px; align-items:center;">
            <input type="hidden" id="friendCsrfParam" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
            <input type="hidden" id="friendCsrfHeader" th:value="${_csrf.headerName}">
            <input type="text" name="username" placeholder="아이디 검색" style="flex:1; padding:8px 10px; border:1px solid #111111; border-radius:8px;">
            <button type="submit" class="btn btn-outline" style="padding:6px 10px;">추가</button>
          </form>
          <div id="friendRequestList" class="notification-list"></div>
        </div>
      </div>
      <div class="profile-wrapper" th:if="${#authorization.expression('isAuthenticated()')}">
        <button type="button" class="icon-button" id="profileButton">
          <span class="profile-icon" aria-hidden="true"
                th:text="${@userService.getUser(#authentication.name)?.avatar != null ? @userService.getUser(#authentication.name).avatar : '👤'}">👤</span>
        </button>
        <div class="profile-panel" id="profilePanel">
          <div class="profile-header">
            <div class="avatar"
                 th:text="${@userService.getUser(#authentication.name)?.avatar != null ? @userService.getUser(#authentication.name).avatar : '🧑'}">🧑</div>
            <div>
              <div class="profile-name" th:text="${#authentication.name}">사용자</div>
              <div class="profile-sub">내 계정</div>
            </div>
          </div>
          <div class="profile-list">
            <a href="/quiz/list" class="profile-item">내 문제 보기</a>
            <a href="/groups" class="profile-item">내 그룹 보기</a>
            <a href="/folders" class="profile-item">내 폴더</a>
            <a href="/profile" class="profile-item">프로필</a>
            <a href="/logout" class="profile-item">로그아웃</a>
          </div>
        </div>
      </div>
      <div class="nav-auth" th:if="${#authorization.expression('!isAuthenticated()')}">
        <a class="nav-pill solid" href="/login">Login</a>
        <a class="nav-pill outline" href="/signup">회원가입</a>
      </div>
    </div>
  </div>
</nav>
